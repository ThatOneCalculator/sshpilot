#!/usr/bin/make -f

%:
	dh $@ --with python3

override_dh_auto_build:
	# Byte-compile python sources
	python3 -m compileall -q sshpilot || true

override_dh_auto_install:
	# Manual install of pure-Python package into dist-packages
	DEST=$(CURDIR)/debian/sshpilot; \
	PKGDIR=$$DEST/usr/lib/python3/dist-packages/sshpilot; \
	install -d $$PKGDIR; \
	cp -a sshpilot/*.py $$PKGDIR/; \
	install -d $$PKGDIR/resources $$PKGDIR/ui; \
	cp -a sshpilot/resources/* $$PKGDIR/resources/; \
	cp -a sshpilot/ui/* $$PKGDIR/ui/; \
	# Entry point (install into package root, not system)
	install -Dm0755 run.py $$DEST/usr/bin/sshpilot; \
	# Desktop and icon
	install -Dm0644 io.github.mfat.sshpilot.desktop $$DEST/usr/share/applications/io.github.mfat.sshpilot.desktop; \
	install -Dm0644 sshpilot/resources/sshpilot.png $$DEST/usr/share/icons/hicolor/256x256/apps/io.github.mfat.sshpilot.png; \
	# Optional GSettings schema
	if [ -f data/io.github.mfat.sshpilot.gschema.xml ]; then \
		install -Dm0644 data/io.github.mfat.sshpilot.gschema.xml $$DEST/usr/share/glib-2.0/schemas/io.github.mfat.sshpilot.gschema.xml; \
	fi

override_dh_auto_clean:
	rm -rf build dist *.egg-info __pycache__ sshpilot/__pycache__


