#!/usr/bin/make -f

export PYBUILD_NAME=sshpilot

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_build:
	# No compiled extensions; ensure resources are present
	python3 -m py_compile sshpilot/*.py || true

override_dh_auto_install:
	# Install Python package (pure)
	python3 -m pip install --root=$(CURDIR)/debian/sshpilot --prefix=/usr --no-deps . || true
	# Install entry script
	install -Dm0755 run.py $(CURDIR)/debian/sshpilot/usr/bin/sshpilot
	# Install desktop file and icon
	install -Dm0644 io.github.mfat.sshpilot.desktop $(CURDIR)/debian/sshpilot/usr/share/applications/io.github.mfat.sshpilot.desktop
	install -Dm0644 sshpilot/resources/sshpilot.png $(CURDIR)/debian/sshpilot/usr/share/icons/hicolor/256x256/apps/io.github.mfat.sshpilot.png
	# Install gschema if present (optional)
	@if [ -f data/io.github.mfat.sshpilot.gschema.xml ]; then \
		install -Dm0644 data/io.github.mfat.sshpilot.gschema.xml $(CURDIR)/debian/sshpilot/usr/share/glib-2.0/schemas/io.github.mfat.sshpilot.gschema.xml; \
	fi

override_dh_auto_clean:
	rm -rf build dist *.egg-info __pycache__ sshpilot/__pycache__


