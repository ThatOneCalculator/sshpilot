#!/usr/bin/make -f

destdir := $(CURDIR)/debian/sshpilot
pypkgdir := $(destdir)/usr/lib/python3/dist-packages/sshpilot

%:
	dh $@ --with python3

override_dh_auto_build:
	# Byte-compile python sources
	python3 -m compileall -q sshpilot || true

override_dh_auto_install:
	# Manual install of pure-Python package into dist-packages
	install -d $(pypkgdir)
	cp -a sshpilot/*.py $(pypkgdir)/
	install -d $(pypkgdir)/resources $(pypkgdir)/ui
	cp -a sshpilot/resources/* $(pypkgdir)/resources/
	cp -a sshpilot/ui/* $(pypkgdir)/ui/
	# Entry point (in package root)
	install -Dm0755 run.py $(destdir)/usr/bin/sshpilot
	# Desktop and icon
	install -Dm0644 io.github.mfat.sshpilot.desktop $(destdir)/usr/share/applications/io.github.mfat.sshpilot.desktop
	install -Dm0644 sshpilot/resources/sshpilot.png $(destdir)/usr/share/icons/hicolor/256x256/apps/io.github.mfat.sshpilot.png
	# Optional GSettings schema
	@if [ -f data/io.github.mfat.sshpilot.gschema.xml ]; then \
		install -Dm0644 data/io.github.mfat.sshpilot.gschema.xml $(destdir)/usr/share/glib-2.0/schemas/io.github.mfat.sshpilot.gschema.xml; \
	fi

override_dh_auto_clean:
	rm -rf build dist *.egg-info __pycache__ sshpilot/__pycache__


