app-id: io.github.mfat.sshpilot
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
command: sshpilot

finish-args:
  - --share=network
  - --socket=ssh-auth
  - --device=dri
  - --filesystem=xdg-download
  - --filesystem=home/.ssh
  - --env=PYTHONUNBUFFERED=1
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/pkgconfig
  - /share/aclocal
  - /man
  - /share/man
  - '*.la'
  - '*.a'
modules:
  - name: sshpilot
    buildsystem: simple
    build-commands:
      - python3 -m pip install --no-cache-dir --prefix=/app -r requirements.txt
      - install -d /app/lib/python3/site-packages/sshpilot
      - cp -a sshpilot/*.py /app/lib/python3/site-packages/sshpilot/
      - install -Dm644 sshpilot/resources/sshpilot.svg /app/share/icons/hicolor/scalable/apps/io.github.mfat.sshpilot.svg
      - install -Dm644 io.github.mfat.sshpilot.desktop /app/share/applications/io.github.mfat.sshpilot.desktop
      - install -Dm644 io.github.mfat.sshpilot.metainfo.xml /app/share/metainfo/io.github.mfat.sshpilot.metainfo.xml
      - install -d /app/bin
      - >
        bash -lc 'cat > /app/bin/sshpilot <<"EOF"\n#!/usr/bin/env bash\nexec python3 -m sshpilot.main "${@}"\nEOF\nchmod +x /app/bin/sshpilot'
    sources:
      - type: dir
        path: .

